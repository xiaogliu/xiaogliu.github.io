<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>Webpack 备忘录 | 刘小光的博客</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Webpack," />
  

  <meta name="description" content="Webpack 属于在项目中配置一次就很少改动的那种工具，但这样就导致新项目再配置 Webpack 时会有些生疏，所以将 Webpack 核心概念及常用配置记录如下。 一 核心概念Webpack 4.x 之前的核心概念有四个：entry，output，loaders，plugins，4.x 之后增加了 mode。含义如下：  Entry：指定 webpack 从哪个 file 开始构建他的依赖关系">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack 备忘录">
<meta property="og:url" content="https://xiaogliu.github.io/2018/12/12/webpack-memo/index.html">
<meta property="og:site_name" content="刘小光的博客">
<meta property="og:description" content="Webpack 属于在项目中配置一次就很少改动的那种工具，但这样就导致新项目再配置 Webpack 时会有些生疏，所以将 Webpack 核心概念及常用配置记录如下。 一 核心概念Webpack 4.x 之前的核心概念有四个：entry，output，loaders，plugins，4.x 之后增加了 mode。含义如下：  Entry：指定 webpack 从哪个 file 开始构建他的依赖关系">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-12-12T13:50:32.000Z">
<meta property="article:modified_time" content="2023-06-04T03:07:02.571Z">
<meta property="article:author" content="刘小光">
<meta property="article:tag" content="Webpack">
<meta name="twitter:card" content="summary">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    
<link rel="stylesheet" href="/css/personal-style.css">

  

  
<!-- Google Analytics -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-87747398-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-87747398-1');
</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b13a69b867cd1964903ac0c912077723";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

<meta name="generator" content="Hexo 6.3.0"></head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            目录
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">一 核心概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E9%85%8D%E7%BD%AE"><span class="toc-text">二 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Entry"><span class="toc-text">2.1 Entry</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Output"><span class="toc-text">2.2 Output</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-output-path"><span class="toc-text">2.2.1 output.path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-output-filename"><span class="toc-text">2.2.2 output.filename</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-output-publickPath"><span class="toc-text">2.2.3 output.publickPath</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Loaders"><span class="toc-text">2.3 Loaders</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-loaders-%E9%85%8D%E7%BD%AE"><span class="toc-text">2.3.1 loaders 配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Plugins"><span class="toc-text">2.4 Plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-plugins-%E9%85%8D%E7%BD%AE"><span class="toc-text">2.4.1 plugins 配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-Mode"><span class="toc-text">2.5 Mode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E5%85%B6%E4%BB%96"><span class="toc-text">2.6 其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-1-optimization"><span class="toc-text">2.6.1 optimization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-2-devtool"><span class="toc-text">2.6.2 devtool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-3-devServer"><span class="toc-text">2.6.3 devServer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-4-resolve"><span class="toc-text">2.6.4 resolve</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E5%B8%B8%E8%A7%81%E9%9C%80%E6%B1%82%E8%AF%A6%E7%BB%86%E9%85%8D%E7%BD%AE"><span class="toc-text">三 常见需求详细配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%BC%95%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93"><span class="toc-text">3.1 引入第三方库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E4%BD%BF%E7%94%A8-npm-%E5%BC%95%E5%85%A5"><span class="toc-text">3.1.1 使用 npm 引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E7%9B%B4%E6%8E%A5%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BC%95%E5%85%A5%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-text">3.1.2 直接在项目中引入源文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%8F%90%E5%8F%96-css"><span class="toc-text">3.2 提取 css</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E7%BC%93%E5%AD%98%E6%8E%A7%E5%88%B6"><span class="toc-text">3.3 缓存控制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E5%B8%B8%E7%94%A8-loaders-%E5%8F%8A-plugins"><span class="toc-text">四 常用 loaders 及 plugins</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%A4%84%E7%90%86-html"><span class="toc-text">4.1 处理 html</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%A4%84%E7%90%86-js%EF%BC%88ts%EF%BC%89"><span class="toc-text">4.2 处理 js（ts）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E5%A4%84%E7%90%86-css%EF%BC%88sass%EF%BC%89"><span class="toc-text">4.3 处理 css（sass）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%A4%84%E7%90%86-%E5%9B%BE%E7%89%87"><span class="toc-text">4.4 处理 图片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E6%9E%84%E5%BB%BA%E7%9B%B8%E5%85%B3-plugins"><span class="toc-text">4.5 构建相关 plugins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%9B%B8%E5%85%B3"><span class="toc-text">4.6 第三方库相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85-loaders-%E5%92%8C-plugins"><span class="toc-text">4.7 一键安装 loaders 和 plugins</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">五 一个完整的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%AE%8C%E6%95%B4%E6%96%87%E4%BB%B6"><span class="toc-text">5.1 完整文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-github-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-text">5.2 github 示例代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">参考资料</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-Webpack备忘录" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Webpack 备忘录</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2018.12.12</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>刘小光</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Webpack/">Webpack</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>Webpack 属于在项目中配置一次就很少改动的那种工具，但这样就导致新项目再配置 Webpack 时会有些生疏，所以将 Webpack 核心概念及常用配置记录如下。</p>
<h1 id="一-核心概念"><a href="#一-核心概念" class="headerlink" title="一 核心概念"></a>一 核心概念</h1><p>Webpack 4.x 之前的核心概念有四个：entry，output，loaders，plugins，4.x 之后增加了 mode。含义如下：</p>
<ul>
<li>Entry：指定 webpack 从哪个 file 开始构建他的依赖关系图，可以有一个和多个，推荐对象表示法；</li>
<li>Output：webpack 构建完成后的 bundles 输出位置及 name，其中 name 一般根据 entry 的 file name 动态生成；</li>
<li>Loaders：webpack 可以将非 js 文件（css、图像等）通过 loaders 处理成可供我们的应用使用的 modules。也因此在配置文件中，loaders 写在<code>module</code>对象下面，因为 loaders 处理后返回的是有效 modules。</li>
<li>Plugins：如果需要额外的功能，比如压缩代码、提取 css、分析打包性能，可使用插件完成；<blockquote>
<p>Loaders 将特定文件转换为有效 module，而 plugin 扩展性更强</p>
</blockquote>
</li>
<li>Mode：接受<code>development</code>、<code>production</code>、<code>none</code>三个值，一般指定为前两个值的一种，webpack 内部针对不同环境做优化。</li>
</ul>
<h1 id="二-配置"><a href="#二-配置" class="headerlink" title="二 配置"></a>二 配置</h1><p>下面介绍的配置都是<code>module.exports</code>的直接属性，比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// loaders 配置位置有些特殊，不知直接写 loaders 对象，而是将它鞋子啊 module 对象下面</span></span><br><span class="line">  <span class="comment">// 因为 loaders 处理完后返回的是有效 modules</span></span><br><span class="line">  <span class="comment">// 不是 复数！！！</span></span><br><span class="line">  <span class="attr">module</span>: &#123;&#125;,</span><br><span class="line">  <span class="comment">// plugin 是数组</span></span><br><span class="line">  <span class="comment">// 是 复数！！！</span></span><br><span class="line">  <span class="attr">plugins</span>: []</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>同时，文件头引入相应依赖的过程省略了，实际开发中请自行引入。</p>
<h2 id="2-1-Entry"><a href="#2-1-Entry" class="headerlink" title="2.1 Entry"></a>2.1 Entry</h2><p>Entry 指定哪些文件作为 webpack 打包入口，可以有一个或者多个：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">entry</span>: &#123;</span><br><span class="line">  <span class="attr">index</span>: <span class="string">&#x27;./src/js/view/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">people</span>: <span class="string">&#x27;./src/js/view/people.js&#x27;</span>,</span><br><span class="line">  <span class="attr">login</span>: <span class="string">&#x27;./src/js/view/login.js&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上例实际是多页面入口，但页面一般只有一个入口文件。实际，目前（2019-07-09）但单页应用都会官方集成 webpack，开箱即用，除非有深度定制要求。反倒是普通多页应用（当然小项目可能只有一个页面，比如简历）在使用 webpack 时必须进行从 0 到 1 的手动配置。</p>
</blockquote>
<h2 id="2-2-Output"><a href="#2-2-Output" class="headerlink" title="2.2 Output"></a>2.2 Output</h2><p>Output 指明 Webpack 处理完成后的 bundles 输入位置及文件 name：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="comment">// 输入目录，这里使用了 node 的 path 模块</span></span><br><span class="line">  <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">  <span class="comment">// [] 里面的内容表示变量</span></span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;js/[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">  <span class="comment">// 静态资源在 html 引用的公共目录</span></span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Output 配置相对复杂：</p>
<h3 id="2-2-1-output-path"><a href="#2-2-1-output-path" class="headerlink" title="2.2.1 output.path"></a>2.2.1 output.path</h3><p>即输出文件目录，推荐使用绝对路径，其中<code>__dirname</code>在 Node 的 path 模块中表示当前目录（即 webpack.config.js 的目录）的绝对路径，<code>resolve</code>方法可以拼接两个目录；</p>
<blockquote>
<p>后一个目录可以加<code>/</code>也可以不加，此处无差别</p>
</blockquote>
<h3 id="2-2-2-output-filename"><a href="#2-2-2-output-filename" class="headerlink" title="2.2.2 output.filename"></a>2.2.2 output.filename</h3><p>表示输出文件名称，这里注意，<code>[]</code>中是变量，其中<code>name</code>由在 entry 中定义的文件名决定，并且，<strong>有多少个输入文件，对应有多少个输出文件</strong>，后面的<code>contenthash:8</code>表示 chunk 的 hash 值，后文介绍；</p>
<blockquote>
<p>实际输出文件一般多于输入文件，因为提取公共代码、设置 sourcemap 都会单独生成输出文件</p>
</blockquote>
<h3 id="2-2-3-output-publickPath"><a href="#2-2-3-output-publickPath" class="headerlink" title="2.2.3 output.publickPath"></a>2.2.3 output.publickPath</h3><p>这个配置想最为复杂，它的作用是配合 loaders 或 plugins 中设置的资源路径，指定静态文件（css、js、img）插入 html 中的引用路径，简单讲，就是 <strong>对输出的静态资源进行目录管理</strong>。这里直接使用 <a target="_blank" rel="noopener" href="http://www.qinshenxue.com/article/20170315092242.html">详解 Webpack2 的那些路径</a> 的描述，只稍作说明。</p>
<p>静态资源最终引用路径计算公式：</p>
<blockquote>
<p>html 静态资源路径 = output.publicPath + loaders/plugins 中设置的资源路径</p>
</blockquote>
<p>比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// publicPath 设置</span></span><br><span class="line">output.<span class="property">publicPath</span> = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// JS output.filename 配置</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;js/[name].js&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// JS 最终访问路径为</span></span><br><span class="line">output.<span class="property">publicPath</span> + <span class="string">&#x27;js/[name].js&#x27;</span> = <span class="string">&#x27;/static/js/[name].js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片资源, file-loader，这里省略了 file-loader 其他配置，只列出指定输出路径及文件名的配置</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;img/[name].[ext]&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 图片最终的访问路径为</span></span><br><span class="line">output.<span class="property">publicPath</span> + <span class="string">&#x27;img/[name].[ext]&#x27;</span> = <span class="string">&#x27;/static/img/[name].[ext]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CSS，ExtractTextPlugin 为提取 CSS 的插件</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ExtractTextPlugin</span>(<span class="string">&quot;css/style.css&quot;</span>)</span><br><span class="line"><span class="comment">// CSS 最终访问路径为</span></span><br><span class="line">output.<span class="property">publicPath</span> + <span class="string">&#x27;css/style.css&#x27;</span> = <span class="string">&#x27;/static/css/style.css&#x27;</span></span><br></pre></td></tr></table></figure>
<p>我们上述指定<code>publicPath</code>为绝对路径，实际上，也支持相对路径，相对于<code>index.html</code>，用的比较少。</p>
<p><code>publicPath</code>默认为空字符串，但为了使输出目录更加条理，推荐使用<code>publicPath</code>对静态资源进行目录管理。</p>
<h2 id="2-3-Loaders"><a href="#2-3-Loaders" class="headerlink" title="2.3 Loaders"></a>2.3 Loaders</h2><p>Loaders 的配置写在<code>module</code>对象中，如前所述，因为 loaders 最终返回的是有效 modules，故使用了<code>module</code>命名，注意是单数。这节介绍 loaders 配置及常用 loaders 两部分内容。</p>
<h3 id="2-3-1-loaders-配置"><a href="#2-3-1-loaders-配置" class="headerlink" title="2.3.1 loaders 配置"></a>2.3.1 loaders 配置</h3><p>loaders 规则写在 <code>module.rules</code> 里面（不知道为什么不直接写在 <code>module</code> 中），其中 <code>rules</code> 是个数组，可接受一个或多个 loader 配置。两点需要注意：</p>
<p>1）如果某类型需要多个 loader 进行处理，在 <code>use</code> 中按 <strong>从右往左</strong> 的顺序流式处理；<br>2）每个 loader 可以进行额外配置；<br>3）像是 <code>postcss-loader</code>, <code>babel-loader</code> 等一般需要额外的配置，<strong>推荐直接在 webpack 配置文件中进行配置，而非在根目录下新建文件</strong>（项目目录看上去更整洁）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="comment">// 含有 rules，这一个属性</span></span><br><span class="line">  <span class="comment">// rules 是数组，每个元素对应一个 loader 配置</span></span><br><span class="line">  <span class="comment">// loader 配置本身是个对象</span></span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 正则匹配文件，最终匹配的是一个路径，具体间解析 zepto 源文件时的设置</span></span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">      <span class="comment">// 使用的 loader，可以字符串（单个 loader）、数组（多个 loader）</span></span><br><span class="line">      <span class="comment">// 如果是数组，从右往左开始解析</span></span><br><span class="line">      <span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;scss-loader&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|jpeg|svg|gif)$/</span>,</span><br><span class="line">      <span class="comment">// 每个 loader 可进行额外配置</span></span><br><span class="line">      <span class="attr">use</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;img/[name].[ext]&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="2-4-Plugins"><a href="#2-4-Plugins" class="headerlink" title="2.4 Plugins"></a>2.4 Plugins</h2><p>同 loaders 一样，分配置和常用 plugins 两部分</p>
<h3 id="2-4-1-plugins-配置"><a href="#2-4-1-plugins-配置" class="headerlink" title="2.4.1 plugins 配置"></a>2.4.1 plugins 配置</h3><p>Plugins 使用相对简单，配置项写在<code>plugins</code>（复数）数组中，元素为插件的实例（通过<code>new</code>调用），生成实例的时候可接收参数，具体看相应插件文档。见下面代码及注释：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="comment">// 带有参数</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>([<span class="string">&#x27;dist&#x27;</span>]),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;css/[name].[contenthash:8].css&#x27;</span>,</span><br><span class="line">    <span class="attr">chunkFileName</span>: <span class="string">&#x27;[id].[contenthash:8].css&#x27;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="comment">// 直接调用</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">UglifyJsPlugin</span>(),</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h2 id="2-5-Mode"><a href="#2-5-Mode" class="headerlink" title="2.5 Mode"></a>2.5 Mode</h2><p>接受<code>development</code>、<code>production</code>、<code>none</code>三个值，一般取前两个值之一，指定构建环境，webpack 本身会做相应优化（配合<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/optimization/">optimization</a>使用，下文会有更多介绍），同时省去在命令行中指定构建环境的过程。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 相当于 webpack --mode=production</span></span><br><span class="line"><span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br></pre></td></tr></table></figure>
<h2 id="2-6-其他"><a href="#2-6-其他" class="headerlink" title="2.6 其他"></a>2.6 其他</h2><p>上述配置对应 Webpack 核心概念，除此之外，还有下面配置项很常用。</p>
<h3 id="2-6-1-optimization"><a href="#2-6-1-optimization" class="headerlink" title="2.6.1 optimization"></a>2.6.1 optimization</h3><p>这个选项是在 Webpack 4.x 中引入的，最常用的配置是代替<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/commons-chunk-plugin/">CommonsChunkPlugin</a>提取公共代码。下面直介绍提取公共 JS 代码的配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="comment">// 只对入口文件处理</span></span><br><span class="line">    <span class="attr">chunks</span>: <span class="string">&#x27;initial&#x27;</span>,</span><br><span class="line">    <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">      <span class="attr">vendor</span>: &#123;</span><br><span class="line">        <span class="comment">//  split  `src/js/vendor` 目录下共用的代码到`vendor.js`</span></span><br><span class="line">        <span class="comment">// 这里指的是第三方库，很少改动，故单独做持久化缓存</span></span><br><span class="line">        <span class="comment">// 注意，目前 splitChunks 在 split css 时有 bug？现在只 split js 代码</span></span><br><span class="line">        <span class="comment">// 不推荐直接匹配 node_modules 文件夹，如上，因为涉及 css，打包后 css 错误</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/src\/js\/vendor\//</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;vendor&#x27;</span>,</span><br><span class="line">        <span class="comment">// 只要第三方库，只要 &gt; 0B, 就 split 出来</span></span><br><span class="line">        <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// 只要被引用一次，也要分离出来</span></span><br><span class="line">        <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// priority: 10,</span></span><br><span class="line">        <span class="comment">// enforce: true,</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">common</span>: &#123;</span><br><span class="line">        <span class="comment">//  split  `src/js/common` 目录下共用的代码到`common.js`</span></span><br><span class="line">        <span class="comment">// 这里是自定义的公共 js 代码，改的频率比第三方库要高，但比具体页面的 js 文件低</span></span><br><span class="line">        <span class="comment">// 故单独 split 出来做持久化缓存</span></span><br><span class="line">        <span class="comment">// 不一定共用才 split ，很少改动的也 split 出来，如上的 vender.js</span></span><br><span class="line">        <span class="comment">// 但此处至少两个共用 minChunks 才抽出</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/src\/js\/common\//</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;common&#x27;</span>,</span><br><span class="line">        <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// priority: 9,</span></span><br><span class="line">        <span class="comment">// enforce: true,</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="2-6-2-devtool"><a href="#2-6-2-devtool" class="headerlink" title="2.6.2 devtool"></a>2.6.2 devtool</h3><p><code>devtool</code>最常用功能是配置 sourcemap，生产和开发环境一般使用不同的 sourcemap，配置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 生产环境</span></span><br><span class="line"><span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开发环境</span></span><br><span class="line"><span class="attr">devtool</span>: <span class="string">&#x27;cheap-module-eval-source-map&#x27;</span>,</span><br></pre></td></tr></table></figure>
<p>关于各配置项的含义可参考<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/devtool/">Devtool</a>和这片文章<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ad96e712564c">Webpack 的 devtool 和 source maps</a>。</p>
<blockquote>
<p>sourcemap 是构建后的代码 map 到源代码的映射表，便于定位 bug，具体的映射关系存储在构建后的<code>.map</code>文件中。</p>
</blockquote>
<p><strong>NOTE</strong>: 这里我们在生产环境使用的是 <code>source-map</code> 选项而不是其他，是因为目前 webpack 在开启 uglifyjs-webpack-plugin 优化代码后，其他模式下的 <a target="_blank" rel="noopener" href="https://github.com/webpack/webpack/issues/2704">sourcemap 选项无效</a>，官网对此也有<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/uglifyjs-webpack-plugin/#sourcemap">说明</a>。虽然使用<code>source-map</code>选项生成的映射表比较大，但只有开启开发者工具的时候<code>.map</code>文件才会加载，这意味着 <strong>映射表文件的大小不影响正常用户的访问体验，但是否压缩 js 文件对正常用户有直接影响</strong>，故，现阶段，生产环境 devtool 使用 <code>source-map</code> 选项。</p>
<h3 id="2-6-3-devServer"><a href="#2-6-3-devServer" class="headerlink" title="2.6.3 devServer"></a>2.6.3 devServer</h3><p>开发环境为了更好的开发体验，可以开启热更新等功能，在<code>devServer</code>中配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>需要在插件中进行下面配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>(),</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>NOTE：如果传统多页面项目，在入口文件后面添加下面代码，配合热更新：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配合 webpack 配置实现热更新</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">hot</span>) &#123;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多页面目前只有在 JS 或者 CSS 文件改变的时候实现了热更新，如果是模版（html）文件改变，没有实现热更新（可以实现自动刷新页面，但感觉很鸡肋，如果改动了模版文件，手动刷新）。</p>
<blockquote>
<p>devServer 还可以设置反向代理，后续填坑。</p>
</blockquote>
<h3 id="2-6-4-resolve"><a href="#2-6-4-resolve" class="headerlink" title="2.6.4 resolve"></a>2.6.4 resolve</h3><p><code>resolve</code> 选项可以指定如何解析 modules，更多是通过设置 alias 告诉 webpack 去哪找文件解析。比如，如果在项目中通过文件的形式引入的 jq，那在使用 <code>ProvidePlugin</code> 对 jq 进行解析的时候，就需要通过设置别名的形式告诉 webpack 去哪找 jq 源文件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line">  <span class="attr">alias</span>: &#123;</span><br><span class="line">    <span class="comment">// 后面加 $ 符号表示精确匹配</span></span><br><span class="line">    <span class="attr">jquery$</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;path/jquery.min.js&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析插件</span></span><br><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123;</span><br><span class="line">  <span class="comment">// 加载 jquery</span></span><br><span class="line">  <span class="attr">$</span>: <span class="string">&#x27;jquery&#x27;</span>,</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<h1 id="三-常见需求详细配置"><a href="#三-常见需求详细配置" class="headerlink" title="三 常见需求详细配置"></a>三 常见需求详细配置</h1><p>下面记录针对具体需求的完整代码描述。</p>
<h2 id="3-1-引入第三方库"><a href="#3-1-引入第三方库" class="headerlink" title="3.1 引入第三方库"></a>3.1 引入第三方库</h2><p>比如，jq，zepto 等，如果通过 CDN 可以在项目中直接使用 <code>$</code> 符号，但如果是通过 npm 安装到本地，甚至直接将第三方库源文件写在项目中，那是无法直接使用 <code>$</code> 符号这种调用方式的，需要使用上文介绍的 <code>ProvidePlugin</code> 插件。当然，还有细节需要注意，见下面详细代码。</p>
<h3 id="3-1-1-使用-npm-引入"><a href="#3-1-1-使用-npm-引入" class="headerlink" title="3.1.1 使用 npm 引入"></a>3.1.1 使用 npm 引入</h3><p>相对于直接引入，使用 npm 可以省去我们手动指定 module 路径的麻烦，已 zepto 为例：</p>
<blockquote>
<p>使用 zepto 时，直接使用 ProvidePlugin 会报错，具体参考这片文章<a target="_blank" rel="noopener" href="https://sebastianblade.com/how-to-import-unmodular-library-like-zepto/">如何在 webpack 中引入未模块化的库，如 Zepto</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理 zepto 模块化问题，需要安装 exports-loader 和 script-loader</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;zepto&#x27;</span>),</span><br><span class="line">  <span class="attr">use</span>: [<span class="string">&#x27;exports-loader?window.Zepto&#x27;</span>, <span class="string">&#x27;script-loader&#x27;</span>],</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 zepto 设置别名，可以任何名称</span></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123;</span><br><span class="line">    <span class="attr">$</span>: <span class="string">&#x27;zepto&#x27;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-直接在项目中引入源文件"><a href="#3-1-2-直接在项目中引入源文件" class="headerlink" title="3.1.2 直接在项目中引入源文件"></a>3.1.2 直接在项目中引入源文件</h3><p>同 npm 不同之处在于我们需要手动指定 zepto 的路径，如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置别名</span></span><br><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line">  <span class="attr">alias</span>: &#123;</span><br><span class="line">    <span class="attr">zepto$</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/js/vendor/zepto.min.js&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理 zepto 模块化问题</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// test 路径也要跟着改变，不知道为什么不能用上面指定的别名。。</span></span><br><span class="line">  <span class="attr">test</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src/js/vendor/zepto.min.js&#x27;</span>),</span><br><span class="line">  <span class="attr">use</span>: [<span class="string">&#x27;exports-loader?window.Zepto&#x27;</span>, <span class="string">&#x27;script-loader&#x27;</span>],</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 zepto 设置别名，可以任何名称</span></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123;</span><br><span class="line">    <span class="attr">$</span>: <span class="string">&#x27;zepto&#x27;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h2 id="3-2-提取-css"><a href="#3-2-提取-css" class="headerlink" title="3.2 提取 css"></a>3.2 提取 css</h2><p>为了能将 css 从 js 中提取出来，需要在 <code>module</code> 中将 style-loader 替换为 MiniCssExtractPlugin.loader，见下面代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;css/[name].[contenthash:8].css&#x27;</span>,</span><br><span class="line">    <span class="comment">// 这个干嘛用？</span></span><br><span class="line">    <span class="attr">chunkFileName</span>: <span class="string">&#x27;[id].[contenthash:8].css&#x27;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h2 id="3-3-缓存控制"><a href="#3-3-缓存控制" class="headerlink" title="3.3 缓存控制"></a>3.3 缓存控制</h2><p>主要一下几个方面：</p>
<ul>
<li>提取 css，添加 <code>contenthash</code>（使用 <code>mini-css-extract-plugin</code>）;</li>
<li>提取公共代码（工具函数等，更改频率相比业务代码要小），添加 <code>contenthash</code>，使用 webpack 自带 splitChunks 提取;</li>
<li>提取第三方库代码（比如 jquery，更改频率相比公共代码还要小），添加 <code>contenthash</code>，使用 webpack 自带 splitChunks 提取;</li>
<li>图片可以直接打 <code>hash</code>（图片文件添加 hash 并不一样，也不会随每次构建改变，还不知原理，反正可以工作，待填坑）。</li>
</ul>
<h1 id="四-常用-loaders-及-plugins"><a href="#四-常用-loaders-及-plugins" class="headerlink" title="四 常用 loaders 及 plugins"></a>四 常用 loaders 及 plugins</h1><p>这里按照功能进行划分。</p>
<h2 id="4-1-处理-html"><a href="#4-1-处理-html" class="headerlink" title="4.1 处理 html"></a>4.1 处理 html</h2><p>1）loaders</p>
<ul>
<li>html-loader：解析 html 文件；</li>
</ul>
<p>2）plugins</p>
<ul>
<li>html-webpack-plugin：将构建后的静态文件动态插入 html 中；</li>
</ul>
<h2 id="4-2-处理-js（ts）"><a href="#4-2-处理-js（ts）" class="headerlink" title="4.2 处理 js（ts）"></a>4.2 处理 js（ts）</h2><p>1）loaders</p>
<ul>
<li>babel-loader：es6+语法转换，目前已支持 ts 转换；</li>
</ul>
<p>2）plugins</p>
<ul>
<li>uglifyjs-webpack-plugin：<strong>不仅仅是压缩代码，还进行了 tree shaking 工作</strong>；</li>
</ul>
<h2 id="4-3-处理-css（sass）"><a href="#4-3-处理-css（sass）" class="headerlink" title="4.3 处理 css（sass）"></a>4.3 处理 css（sass）</h2><p>1）loaders</p>
<ul>
<li>sass-loader：解析 scss/sass 文件；</li>
<li>css-loader：解析 css 文件；</li>
<li>style-loader：将解析后的 css 嵌入 js；</li>
<li><p>postcss-loader：完成 css 自动化处理，比如添加前缀、压缩 css、自动生成雪碧图等</p>
<blockquote>
<p>postcss 本身支持插件扩展，常用的有 autoprefixer、cssnano、postcss-sprites，更多参考<a target="_blank" rel="noopener" href="https://github.com/postcss/postcss">官网介绍</a><br>要在 css-loader 之前处理 css：<code>use: [MiniCssExtractPlugin.loader, &#39;css-loader&#39;, &#39;postcss-loader&#39;]</code></p>
</blockquote>
</li>
<li><p>MiniCssExtractPlugin.loader：这个是 <code>mini-css-extract-plugin</code> 提供的 loader，可以替代 <code>style-loader</code></p>
</li>
</ul>
<p>2）plugins</p>
<ul>
<li><p>mini-css-extract-plugin：提取 css 文件，减小增量更新成本（<strong>需要在<code>module</code>代理 style-loader 处理 css</strong>）；</p>
<blockquote>
<p>这个插件将 css 从 js 中分离出来，是 webpack 4.x 新引入，代替 extract-text-webpack-plugin。</p>
</blockquote>
</li>
<li><p>optimize-css-assets-webpack-plugin：将提取出的 css 做进一步优化；</p>
</li>
</ul>
<h2 id="4-4-处理-图片"><a href="#4-4-处理-图片" class="headerlink" title="4.4 处理 图片"></a>4.4 处理 图片</h2><p>1）loaders</p>
<ul>
<li>file-loader：解析图片文件；</li>
<li>url-loader：具有 file-loader 的全部功能，同时可以提取小图片为 base64（如果开启 HTTP2 这样增大 静态资源体积反而不好？）；</li>
</ul>
<h2 id="4-5-构建相关-plugins"><a href="#4-5-构建相关-plugins" class="headerlink" title="4.5 构建相关 plugins"></a>4.5 构建相关 plugins</h2><p>涉及到构建的主要是 plugins，分为内置和第三方</p>
<p>1）webpack 内置</p>
<ul>
<li>webpack.HotModuleReplacementPlugin：热更新插件，webpack 内置；</li>
<li>ProvidePlugin：webpack 内置，提取第三方库的 api，比如通过 <code>$</code> 符号调用 jq<blockquote>
<p>如果不是通过 npm 安装，而是直接在项目中引入，需要配合<code>resolve</code>的别名使用，不然找不到</p>
</blockquote>
</li>
</ul>
<p>2）第三方</p>
<ul>
<li>webpack-merge：实际项目中，一般将 webpack 配置文件拆分为 base、dev、pro，这个插件用户合并配置文件；</li>
<li>clean-webpack-plugin：清除指定文件夹，一般是构建的目录（大型项目慎用，更新需要时间）；</li>
<li>webpack-bundle-analyzer：打包后文件图形化展示工具，一目了然各文件体积；</li>
</ul>
<h2 id="4-6-第三方库相关"><a href="#4-6-第三方库相关" class="headerlink" title="4.6 第三方库相关"></a>4.6 第三方库相关</h2><p>事实上，目前（2019-07-09）第三方库（react，vue，angular）都已经集成好了 webpack，如果不是特别需要，可以不进行单独配置。</p>
<p>1）Vue 相关</p>
<ul>
<li>vue-loader：解析 vue 文件；</li>
<li>vue-style-loader：解析 vue 中的样式文件。</li>
</ul>
<p>2）jquery 和 zepto ?</p>
<p>尝试用原生 js 写，兼容到 ie10 +</p>
<h2 id="4-7-一键安装-loaders-和-plugins"><a href="#4-7-一键安装-loaders-和-plugins" class="headerlink" title="4.7 一键安装 loaders 和 plugins"></a>4.7 一键安装 loaders 和 plugins</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i -D html-webpack-plugin @babel/core @babel/preset-env @babel/preset-typescript typescript babel-loader uglifyjs-webpack-plugin node-sass sass-loader css-loader mini-css-extract-plugin postcss-loader postcss-cssnext cssnano clean-webpack-plugin webpack webpack-bundle-analyzer webpack-cli webpack-dev-server webpack-merge</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li><code>@babel/core @babel/preset-env @babel/preset-typescript typescript</code> babel 依赖，包含了处理 typescript 的 package</li>
<li><code>node-sass</code> 处理 <code>sass</code> 的依赖</li>
<li><code>postcss-cssnext cssnano</code> 这两个是 postcss 的插件，其中 <code>postcss-cssnext</code> 可用于写 css next 版本的语法，同时补全浏览器前缀；而 <code>cssnano</code> 可以用来减少 css 文件体积，不止是压缩，可其参考<a target="_blank" rel="noopener" href="https://cssnano.co/">官方文档示例</a></li>
</ul>
<h1 id="五-一个完整的配置文件"><a href="#五-一个完整的配置文件" class="headerlink" title="五 一个完整的配置文件"></a>五 一个完整的配置文件</h1><h2 id="5-1-完整文件"><a href="#5-1-完整文件" class="headerlink" title="5.1 完整文件"></a>5.1 完整文件</h2><p>示例配置文件只添加了处理 html、js、css 的基础 loaders 和 plugins 以及配置开发环境，至于像 <code>DllPlugin</code> 这种高阶插件的使用并没有列入其中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>); <span class="comment">//to access built-in plugins</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>); <span class="comment">//installed via npm</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UglifyJsPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;uglifyjs-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="comment">// entry files, can multiple files</span></span><br><span class="line">    <span class="attr">index</span>: <span class="string">&quot;./src/scripts/index.ts&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// output directory</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="comment">// variable in []</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/[name].[hash:8].js&quot;</span>,</span><br><span class="line">    <span class="comment">// html static file directory</span></span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">presets</span>: [</span><br><span class="line">            [</span><br><span class="line">              <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">targets</span>: &#123;</span><br><span class="line">                  <span class="attr">node</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;@babel/typescript&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">plugins</span>: <span class="function">() =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">&#x27;postcss-cssnext&#x27;</span>)(),</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">&#x27;cssnano&#x27;</span>)()</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">plugins</span>: <span class="function">() =&gt;</span> [</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">&#x27;postcss-cssnext&#x27;</span>)(),</span><br><span class="line">                <span class="built_in">require</span>(<span class="string">&#x27;cssnano&#x27;</span>)()</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;sass-loader&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|jpeg|svg|gif)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;file-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&quot;img/[name].[ext]&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// recognize typescript</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.js&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">      <span class="comment">// 这个干嘛用？</span></span><br><span class="line">      <span class="attr">chunkFileName</span>: <span class="string">&quot;[id].[contenthash:8].css&quot;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123; <span class="attr">template</span>: <span class="string">&quot;./src/pages/index.html&quot;</span> &#125;),</span><br><span class="line">    <span class="comment">// 直接调用</span></span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>()</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [<span class="keyword">new</span> <span class="title class_">UglifyJsPlugin</span>()]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="comment">// 生产环境</span></span><br><span class="line">  <span class="comment">// devtool: &quot;source-map&quot;,</span></span><br><span class="line">  <span class="comment">// 开发环境</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;cheap-module-eval-source-map&quot;</span>,</span><br><span class="line">  <span class="comment">// 使用webpack-dev-server，提高开发效率</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="5-2-github-示例代码"><a href="#5-2-github-示例代码" class="headerlink" title="5.2 github 示例代码"></a>5.2 github 示例代码</h2><!-- TODO 提供多个参考配置文件（1.拆分；2.带有 zepto；3.不带 zepto 等） -->
<p>在 github 上提供了一个示例代码</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="http://www.qinshenxue.com/article/20170315092242.html">详解 Webpack2 的那些路径</a></p>

    
  </div>

</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2018/09/20/config-win10-sub-linux-sys/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2019/07/24/rollup-config/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              目录
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'xiaogliu';
    
    var disqus_url = 'https://xiaogliu.github.io/2018/12/12/webpack-memo/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//xiaogliu.disqus.com/count.js" async></script>



    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
