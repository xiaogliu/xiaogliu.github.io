<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>开发 React Native APP（二） | 刘小光的博客</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Hybrid App,React,Android," />
  

  <meta name="description" content="经过第一部分开发 React Native APP（一）介绍，App 框架基本构建完成，这部分主要讨论 UI&#x2F;交互、App 发布前的准备工作及如何发布，具体内容包括：  在使用 react navigation 的前提下，iOS 实现单个页面从下往上（modal）的进入动画 尺寸自适应 设置启动页，更换桌面图标、app 展示名称、appID 打包发布  完整 demo 在这 react-nativ">
<meta property="og:type" content="article">
<meta property="og:title" content="开发 React Native APP（二）">
<meta property="og:url" content="https://xiaogliu.github.io/2018/02/27/develop-react-native-app-2/index.html">
<meta property="og:site_name" content="刘小光的博客">
<meta property="og:description" content="经过第一部分开发 React Native APP（一）介绍，App 框架基本构建完成，这部分主要讨论 UI&#x2F;交互、App 发布前的准备工作及如何发布，具体内容包括：  在使用 react navigation 的前提下，iOS 实现单个页面从下往上（modal）的进入动画 尺寸自适应 设置启动页，更换桌面图标、app 展示名称、appID 打包发布  完整 demo 在这 react-nativ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/nav_diff_entry.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/px_to_dp.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/autod_pic.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/ios_app_icon.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/ios_app_name.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/launch_image1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/launch_image2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/launch_image.gif">
<meta property="article:published_time" content="2018-02-27T11:55:29.000Z">
<meta property="article:modified_time" content="2023-06-04T03:07:02.575Z">
<meta property="article:author" content="刘小光">
<meta property="article:tag" content="Hybrid App">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/nav_diff_entry.gif">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    
<link rel="stylesheet" href="/css/personal-style.css">

  

  
<!-- Google Analytics -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-87747398-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-87747398-1');
</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b13a69b867cd1964903ac0c912077723";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

<meta name="generator" content="Hexo 6.3.0"></head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            目录
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E6%89%A9%E5%B1%95-react-navigation"><span class="toc-text">一 扩展 react navigation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BF%AE%E6%94%B9-StackNavigator-API"><span class="toc-text">1.1 修改 StackNavigator API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E9%A1%B5%E9%9D%A2%E4%B8%AD%E8%B0%83%E7%94%A8"><span class="toc-text">1.2 页面中调用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E8%87%AA%E9%80%82%E5%BA%94"><span class="toc-text">二 自适应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%B0%BA%E5%AF%B8%E8%87%AA%E9%80%82%E5%BA%94"><span class="toc-text">2.1 尺寸自适应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%9B%BE%E7%89%87%E5%88%86%E8%BE%A8%E7%8E%87%E8%87%AA%E9%80%82%E5%BA%94"><span class="toc-text">2.3 图片分辨率自适应</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-%E4%BF%AE%E6%94%B9%E6%A1%8C%E9%9D%A2%E5%9B%BE%E6%A0%87%E3%80%81App-%E5%B1%95%E7%A4%BA%E5%90%8D%E7%A7%B0%EF%BC%8C%E8%AE%BE%E7%BD%AE%E5%90%AF%E5%8A%A8%E9%A1%B5"><span class="toc-text">三 修改桌面图标、App 展示名称，设置启动页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E8%AE%BE%E7%BD%AE%E6%A1%8C%E9%9D%A2%E5%9B%BE%E6%A0%87"><span class="toc-text">3.1 设置桌面图标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E4%BF%AE%E6%94%B9-App-%E5%B1%95%E7%A4%BA%E5%90%8D%E7%A7%B0"><span class="toc-text">3.2 修改 App 展示名称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E8%AE%BE%E7%BD%AE%E5%90%AF%E5%8A%A8%E9%A1%B5"><span class="toc-text">3.3 设置启动页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C%E5%9B%BE"><span class="toc-text">3.4 最终效果图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83"><span class="toc-text">四 打包发布</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%AE%89%E5%8D%93%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83"><span class="toc-text">4.1 安卓打包发布</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-iOS-%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83"><span class="toc-text">4.2 iOS 打包发布</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-%E5%B0%8F%E7%BB%93"><span class="toc-text">五 小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">参考资料</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-开发-React-Native-APP（二）" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">开发 React Native APP（二）</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2018.02.27</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>刘小光</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Hybrid-App/">Hybrid App</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>经过第一部分<a href="https://xiaogliu.github.io/2018/02/27/develop-react-native-app-1/">开发 React Native APP（一）</a>介绍，App 框架基本构建完成，这部分主要讨论 UI/交互、App 发布前的准备工作及如何发布，具体内容包括：</p>
<ul>
<li>在使用 react navigation 的前提下，<strong>iOS 实现单个页面从下往上（modal）的进入动画</strong></li>
<li>尺寸自适应</li>
<li>设置启动页，更换桌面图标、app 展示名称、appID</li>
<li>打包发布</li>
</ul>
<p>完整 demo 在这 <a target="_blank" rel="noopener" href="https://github.com/xiaogliu/react-native-complete-demo">react-native-complete-demo</a></p>
<h1 id="一-扩展-react-navigation"><a href="#一-扩展-react-navigation" class="headerlink" title="一 扩展 react navigation"></a>一 扩展 react navigation</h1><p>这里的扩展指的是实现<strong>可单独配置页面的进入方式</strong>（<a target="_blank" rel="noopener" href="https://reactnavigation.org/docs/stack-navigator.html">react navigation</a> 默认只支持全局配置，要么 <code>card</code>，要么 <code>modal</code>，配置后所有页面进入动画相同）。</p>
<p>实现上述效果需要做两方面修改：<code>StackNavigator</code> API（在 <code>route.js</code> 中使用）和进入某个页面是的调用方式。</p>
<h2 id="1-1-修改-StackNavigator-API"><a href="#1-1-修改-StackNavigator-API" class="headerlink" title="1.1 修改 StackNavigator API"></a>1.1 修改 <code>StackNavigator</code> API</h2><p>修改后如果使页面默认状态为 card，只需要输入对应页面即可，比如 <code>..navigate(&#39;ScreenSome1&#39;)</code>；如果要使某个页面进入方式为 modal 只需要在路径上加上 Modal 比如：<code>..navigate(&#39;ScreenSome2Modal&#39;)</code>。</p>
<p>需要注意的是<strong>如果页面进入方式为 modal，需要自定义 header，因为默认 header 样式失效，都叠在一块了</strong>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * route.js</span></span><br><span class="line"><span class="comment"> * 自定义 StackNavigator，可以选择 screen 进入方式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">StackModalNavigator</span> = (<span class="params">routeConfigs, navigatorConfig</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">CardStackNavigator</span> = <span class="title class_">StackNavigator</span>(routeConfigs, navigatorConfig);</span><br><span class="line">  <span class="keyword">const</span> modalRouteConfig = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> routeNames = <span class="title class_">Object</span>.<span class="title function_">keys</span>(routeConfigs);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; routeNames.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    modalRouteConfig[<span class="string">`<span class="subst">$&#123;routeNames[i]&#125;</span>Modal`</span>] = routeConfigs[routeNames[i]];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">ModalStackNavigator</span> = <span class="title class_">StackNavigator</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="title class_">CardStackNavigator</span>: &#123; <span class="attr">screen</span>: <span class="title class_">CardStackNavigator</span> &#125;,</span><br><span class="line">      ...modalRouteConfig</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 如果页面进入方式为 modal，需要自定义 header（默认 header 样式失效，都叠在一块了）</span></span><br><span class="line">      <span class="attr">mode</span>: <span class="string">&quot;modal&quot;</span>,</span><br><span class="line">      <span class="attr">headerMode</span>: <span class="string">&quot;none&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">ModalStackNavigator</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置路由</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AppNavigator</span> = <span class="title class_">StackModalNavigator</span>();</span><br></pre></td></tr></table></figure>
<h2 id="1-2-页面中调用"><a href="#1-2-页面中调用" class="headerlink" title="1.2 页面中调用"></a>1.2 页面中调用</h2><p>首先我们新建页面 <code>ScreenSome2</code>，接下来就让它以 modal 的形式进入（从屏幕下面进入），作为对比 <code>ScreenSome1</code> 以 <code>card</code> 的形式进入（默认进入方式，从屏幕右侧进入）。</p>
<p>因为以 modal 形式进入的页面需要自定义 header，一般只是一个关闭按钮，以 <code>ScreenSome2</code> 为例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ScreenSome2/view.js</span></span><br><span class="line"><span class="comment"> * 自定义 header（关闭按钮）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;<span class="title class_">View</span>&gt;</span><br><span class="line">  &#123;<span class="comment">/* TouchableHighlight 为关闭按钮的热区 */</span>&#125;</span><br><span class="line">  &lt;<span class="title class_">TouchableHighlight</span></span><br><span class="line">    onPress=&#123;<span class="function">() =&gt;</span> self.<span class="property">navigation</span>.<span class="title function_">goBack</span>()&#125;</span><br><span class="line">    underlayColor=<span class="string">&quot;transparent&quot;</span></span><br><span class="line">    style=&#123;&#123;</span><br><span class="line">      <span class="attr">display</span>: <span class="string">&quot;flex&quot;</span>,</span><br><span class="line">      <span class="attr">justifyContent</span>: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">      <span class="attr">marginTop</span>: <span class="title function_">pxToDp</span>(<span class="number">30</span>),</span><br><span class="line">      <span class="attr">width</span>: <span class="title function_">pxToDp</span>(<span class="number">150</span>),</span><br><span class="line">      <span class="attr">height</span>: <span class="title function_">pxToDp</span>(<span class="number">90</span>),</span><br><span class="line">      <span class="attr">backgroundColor</span>: <span class="string">&quot;yellow&quot;</span></span><br><span class="line">    &#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginLeft:</span> <span class="attr">pxToDp</span>(<span class="attr">24</span>) &#125;&#125;&gt;</span>关闭<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line">  &lt;/<span class="title class_">TouchableHighlight</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">fontSize:</span> <span class="attr">pxToDp</span>(<span class="attr">36</span>) &#125;&#125;&gt;</span>some2，以 modal 的形式进入<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">View</span>&gt;</span><br></pre></td></tr></table></figure>
<p>然后就是更改进入 <code>ScreenSome2</code> 代码，这里是 <code>ScreenHome</code> 页面中的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ScreenHome/view.js</span></span><br><span class="line"><span class="comment"> * 自定义 header（关闭按钮）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* ScreenSome2 从屏幕右侧进入 */</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">Button</span></span><br><span class="line">  title=<span class="string">&quot;goSome1&quot;</span></span><br><span class="line">  onPress=&#123;<span class="function">() =&gt;</span> self.<span class="property">navigation</span>.<span class="title function_">navigate</span>(<span class="string">&quot;ScreenSome1&quot;</span>)&#125;</span><br><span class="line">/&gt;;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* ScreenSome2 从屏幕下面进入 */</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">Button</span></span><br><span class="line">  title=<span class="string">&quot;goSome2Modal&quot;</span></span><br><span class="line">  onPress=&#123;<span class="function">() =&gt;</span> self.<span class="property">navigation</span>.<span class="title function_">navigate</span>(<span class="string">&quot;ScreenSome2Modal&quot;</span>)&#125;</span><br><span class="line">/&gt;;</span><br></pre></td></tr></table></figure>
<p>最终效果图：<br><img src="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/nav_diff_entry.gif" alt="自定义页面进入动画"></p>
<h1 id="二-自适应"><a href="#二-自适应" class="headerlink" title="二 自适应"></a>二 自适应</h1><p>自适应主要包括两方面：尺寸根据屏幕大小自适应，包括 <code>fontSize</code>，<code>width</code> 等；图片分辨率根据屏幕分辨率自适应，也就常说的二倍图、三倍图等。</p>
<h2 id="2-1-尺寸自适应"><a href="#2-1-尺寸自适应" class="headerlink" title="2.1 尺寸自适应"></a>2.1 尺寸自适应</h2><p>尺寸自适应的原理是通过获取手机屏幕的宽度，尺寸做相应比例的调整，为此封装了一个工具函数，放在了 <code>config/pxToDp.js</code> 中。</p>
<p>调整后的目录如下：</p>
<p><img src="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/px_to_dp.png" alt="尺寸转换函数目录"></p>
<ul>
<li><code>config/pxToDp.js</code> 尺寸转换的工具函数</li>
</ul>
<blockquote>
<p>尺寸转换的工具函数在第一部分<a href="https://xiaogliu.github.io/2018/02/27/develop-react-native-app-1/">开发 React Native APP（一）</a>已经添加</p>
</blockquote>
<p>1）编写自适应尺寸工具函数</p>
<p>因为所有涉及尺寸的数据都要转换（<code>fontSize</code>，<code>width</code>等），所以对转换后的数据要做处理，保证：1.大于等于 1 的数字向上取整；2.小于 1 的数字，如果是 ios 平台统一设为 0.5；如果是安卓平台统一设为 1（因为安卓平台分辨率千差万别万别，低分辨率的屏幕显示 0.5 的尺寸会有锯齿状）。工具函数完整代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pxToDp.js</span></span><br><span class="line"><span class="comment"> * 自适应布局</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uiElementPx: ui给的原始尺寸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Dimensions</span>, <span class="title class_">Platform</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-native&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app 只有竖屏模式，所以可以只获取一次 width</span></span><br><span class="line"><span class="keyword">const</span> deviceWidthDp = <span class="title class_">Dimensions</span>.<span class="title function_">get</span>(<span class="string">&quot;window&quot;</span>).<span class="property">width</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UI 默认给图是 750</span></span><br><span class="line"><span class="keyword">const</span> uiWidthPx = <span class="number">750</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pxToDp</span>(<span class="params">uiElementPx</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> transferNumb = uiElementPx * deviceWidthDp / uiWidthPx;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (transferNumb &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// 避免出现循环小数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">ceil</span>(transferNumb);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Platform</span>.<span class="property">OS</span> === <span class="string">&quot;android&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果是安卓，最小为1，避免边框出现锯齿</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pxToDp;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实际上，通过 <code>Dimensions.get(&#39;window&#39;).width</code> 获取的屏幕宽度和自己想象的可能有出入，比如，iphone7 屏幕 4.7’’，获取到的宽度是 <code>375</code>，华为 P9 是 5.2’，但获取到的宽度却是是 <code>360</code>！有点坑，这个工具函数还有待优化。</p>
</blockquote>
<p>2）使用自适应尺寸工具函数</p>
<p>使用方法很简单，在需要转换单位的组件中将转换尺寸的工具函数引入，将需要转换的尺寸传入工具函数即可，以 <code>ScreenHome</code> 为例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ScreenHome/view.js</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入尺寸转换工具函数</span></span><br><span class="line"><span class="keyword">import</span> pxToDp <span class="keyword">from</span> <span class="string">&quot;../../config/pxToDp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将需要转换的单位传入 pxToDp 中</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">fontSize:</span> <span class="attr">pxToDp</span>(<span class="attr">36</span>) &#125;&#125;&gt;</span>home<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-图片分辨率自适应"><a href="#2-3-图片分辨率自适应" class="headerlink" title="2.3 图片分辨率自适应"></a>2.3 图片分辨率自适应</h2><p>手机分辨率越来越多，尤其安卓，React Native 可以根据不同分辨率加载不同尺寸的图片，只需在图片命名上面加以区分。</p>
<ul>
<li>提供不同分辨率的图片</li>
</ul>
<p>比如我们有张图片叫 <code>test.png</code>，尺寸为 <code>40 x 40</code>（单位像素），为了做到自适应屏幕分辨率，我们还需要提供它的 2 倍图，3 倍图，这样，一张图片就对应 3 个尺寸，如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 一张图片提供 3个尺寸</span></span><br><span class="line"></span><br><span class="line">test.png <span class="comment"># 尺寸 40 x 40</span></span><br><span class="line"><span class="built_in">test</span>@2x.png <span class="comment"># 尺寸 80 x 80</span></span><br><span class="line"><span class="built_in">test</span>@3x.png <span class="comment"># 尺寸 120 x 120</span></span><br></pre></td></tr></table></figure>
<p><code>name@nx</code>是 n (n &gt; 1) 倍图命名规范，React Native 也是根据命名判断图片尺寸的。</p>
<ul>
<li>使用</li>
</ul>
<p>在引用图片的时候直接使用 <strong>不加倍率后缀的图片名</strong>，比如，直接使用 <code>test.png</code>，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ScreenTab3/view.js</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="title class_">Image</span></span><br><span class="line">  source=&#123;<span class="built_in">require</span>(<span class="string">&quot;../../assets/images/test.png&quot;</span>)&#125;</span><br><span class="line">  style=&#123;&#123; <span class="attr">height</span>: <span class="title function_">pxToDp</span>(<span class="number">80</span>), <span class="attr">width</span>: <span class="title function_">pxToDp</span>(<span class="number">80</span>) &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>最终效果图如下：</p>
<ul>
<li>iphone6： 2 倍图（图片放大后可以看到里面有 <code>2X</code> 字样）</li>
<li>iphone7Plus：3 倍图（图片放大后可以看到里面有 <code>3X</code> 字样）</li>
<li>Nexus4：2 倍图</li>
<li>Pixel2：3 倍图</li>
</ul>
<p><img src="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/autod_pic.png" alt="自定加载不同分辨率图片"></p>
<h1 id="三-修改桌面图标、App-展示名称，设置启动页"><a href="#三-修改桌面图标、App-展示名称，设置启动页" class="headerlink" title="三 修改桌面图标、App 展示名称，设置启动页"></a>三 修改桌面图标、App 展示名称，设置启动页</h1><p>修改桌面图标、App 展示名称相对简单，设置启动页稍微麻烦。另外，iOS 修改桌面图标、App 展示名称，设置启动页都需要在 Xcode 中进行。</p>
<h2 id="3-1-设置桌面图标"><a href="#3-1-设置桌面图标" class="headerlink" title="3.1 设置桌面图标"></a>3.1 设置桌面图标</h2><p>因为 App 图标对应多个尺寸，手动改写太麻烦，这个网站可以自动生成 <a target="_blank" rel="noopener" href="https://makeappicon.com/">MakeAppIcon</a>。(Thanks Alejandra’s recommendation that <a target="_blank" rel="noopener" href="https://www.websiteplanet.com/webtools/favicon-generator/">Website Planet</a> also can generate App icon and supports file less 5M.)</p>
<blockquote>
<p>并不是所有尺寸的图片都需要，见下文。</p>
</blockquote>
<ul>
<li>iOS</li>
</ul>
<p>准确点讲不能叫设置桌面图标，而应该是 App 图标，因为我们需要设置的不止有桌面展示的图标，还有设置时 app 图标、消息推送时 app 图标，此外如果要发布到 App store，还需要设置 Apple Store 展示用的 App 图标。</p>
<p>1）图片准备</p>
<p>以上不同地方用到的 app 图标尺寸各不相同，具体如下（<strong>只针对 iphone，不包括 ipad，iwatch</strong>）：</p>
<table>
<thead>
<tr>
<th>尺寸</th>
<th>名称</th>
<th>用途</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>120x120</td>
<td><a href="mailto:Icon-60@2x.png">Icon-60@2x.png</a></td>
<td>桌面图标 (2x)</td>
<td>必须</td>
</tr>
<tr>
<td>180x180</td>
<td><a href="mailto:Icon-60@3x.png">Icon-60@3x.png</a></td>
<td>桌面图标 (3x)</td>
<td>可选，但推荐设置</td>
</tr>
<tr>
<td>80x80</td>
<td><a href="mailto:Icon-40@2x.png">Icon-40@2x.png</a></td>
<td>Spotlight 图标 (2x)</td>
<td>可选，但推荐设置</td>
</tr>
<tr>
<td>120x120</td>
<td><a href="mailto:Icon-40@3x.png">Icon-40@3x.png</a></td>
<td>Spotlight 图标 (3x)</td>
<td>可选，但推荐设置</td>
</tr>
<tr>
<td>58x58</td>
<td><a href="mailto:Icon-29@2x.png">Icon-29@2x.png</a></td>
<td>设置图标 (2x)</td>
<td>可选，但推荐设置</td>
</tr>
<tr>
<td>87x87</td>
<td><a href="mailto:Icon-29@3x.png">Icon-29@3x.png</a></td>
<td>设置图标 (3x)</td>
<td>可选，但推荐设置</td>
</tr>
<tr>
<td>40x40</td>
<td><a href="mailto:Icon-20@2x.png">Icon-20@2x.png</a></td>
<td>通知图标 (3x)</td>
<td>可选，但推荐设置</td>
</tr>
<tr>
<td>80x80</td>
<td><a href="mailto:Icon-20@3x.png">Icon-20@3x.png</a></td>
<td>通知图标 (3x)</td>
<td>可选，但推荐设置</td>
</tr>
<tr>
<td>1024x1024</td>
<td><a href="mailto:iTunesArtwork@2x.png">iTunesArtwork@2x.png</a></td>
<td>App Store (2x)</td>
<td>必须</td>
</tr>
</tbody>
</table>
<blockquote>
<p>名称不是说一定要和上面相同，但 <code>Icon</code> 、尺寸（如 <code>60</code>）还有倍率（@nx）要有，类型为 <code>png</code>。</p>
</blockquote>
<p>2）将图片拖放至 Xcode 指定位置，具体是：<code>Project Navigator -&gt; Images.xcassets -&gt; AppIcon</code>，如下图</p>
<p><img src="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/ios_app_icon.png" alt="iOS AppIcon"></p>
<blockquote>
<p>拖放完成后，通过文件管理器查看项目目录，也会发现相应图片。</p>
</blockquote>
<ul>
<li>安卓</li>
</ul>
<p>安卓的 app 图标相对简单，只需要设置桌面图标。设置位置在 <code>yourApp/android/app/src/main/res/</code> 目录下，这个目录默认有四个文件夹，里面各对应放置了一种尺寸的桌面图标图片，图片尺寸不同，但名称相同，统一为 <code>ic_launcher.png</code>，具体如下所示：</p>
<table>
<thead>
<tr>
<th>文件夹名称</th>
<th>含义</th>
<th>文件夹内部图片尺寸</th>
<th>文件夹内部图片名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>mipmap-ldpi</td>
<td>Low Density Screen</td>
<td>36x36</td>
<td>ic_launcher.png</td>
</tr>
<tr>
<td>mipmap-mdpi</td>
<td>Medium Density Screen</td>
<td>48x48</td>
<td>ic_launcher.png</td>
</tr>
<tr>
<td>mipmap-hdpi</td>
<td>High Density Screen</td>
<td>72x72</td>
<td>ic_launcher.png</td>
</tr>
<tr>
<td>mipmap-xhdpi</td>
<td>Extra-high density screen</td>
<td>96x96</td>
<td>ic_launcher.png</td>
</tr>
<tr>
<td>mipmap-xxhdpi</td>
<td>xx-high density screen</td>
<td>144x144</td>
<td>ic_launcher.png</td>
</tr>
<tr>
<td>mipmap-xxxhdpi</td>
<td>xxx-high density screen</td>
<td>192x192</td>
<td>ic_launcher.png</td>
</tr>
</tbody>
</table>
<p>如果你使用了 MakeAppIcon 的服务，直接将对应文件夹全部放入 <code>res/</code> 目录下就好，不然就手动替换图标。</p>
<blockquote>
<p>可以根据实际需求删除不必要的文件，比如，120 DPI 的屏幕很少了，那么这个文件夹就可以不要</p>
</blockquote>
<h2 id="3-2-修改-App-展示名称"><a href="#3-2-修改-App-展示名称" class="headerlink" title="3.2 修改 App 展示名称"></a>3.2 修改 App 展示名称</h2><ul>
<li>iOS</li>
</ul>
<p>调出工程设置菜单（双击工程名称或者单击然后然后右侧选择 Targets –&gt; yourProject），进入 <code>info</code> 选项，在 <code>Custom iOS Target Properties</code> 中添加 <code>Bundle display name</code>，其 <code>value</code> 便是 App 的名称。具体设置如下图：</p>
<p><img src="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/ios_app_name.png" alt="ios修改app名称"></p>
<ul>
<li>安卓</li>
</ul>
<p>安卓修改 App 展示名称在这个文件中 <code>yourApp/android/app/src/main/res/values/strings.xml</code>。</p>
<p><code>strings.xml</code> 这个文件很简单，全部内容如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;app_name&quot;</span>&gt;</span>你的app名称<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>替换 <code>你的app名称</code> 为你想要的名字就好。</p>
<p>NOTE：</p>
<p>安卓的话，还要修改默认包名（<code>applicationId</code>），如果不修改，如果系统监测到当前应用的 <code>applicationId</code> 和已安装的某个应用相同而签名不同，会报错：“签名不一致 该应用可能已被恶意篡改”。</p>
<p>在这个文件中修改包名： <code>yourApp/android/app/build.gradle</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">defaultConfig &#123;</span><br><span class="line">    applicationId <span class="string">&quot;com.yourAppId&quot;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-设置启动页"><a href="#3-3-设置启动页" class="headerlink" title="3.3 设置启动页"></a>3.3 设置启动页</h2><p>这里使用了第三方插件<a target="_blank" rel="noopener" href="https://github.com/crazycodeboy/react-native-splash-screen/">react-native-splash-screen</a>，官网教程已经很详细，这里做简要介绍。</p>
<ul>
<li>项目中安装依赖</li>
</ul>
<p>1）下载依赖</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add react-native-splash-screen</span><br></pre></td></tr></table></figure>
<p>2）添加到项目中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">react-native link react-native-splash-screen</span><br></pre></td></tr></table></figure>
<p>3）在 React Native 配置</p>
<p>这里指的是设置启动页什么时候消失，下面的代码是首页加载完 5s 后启动页消失。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ScreenHome/index.js</span></span><br><span class="line"><span class="comment"> * 设置启动页消失时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SplashScreen</span> <span class="keyword">from</span> <span class="string">&quot;react-native-splash-screen&quot;</span>; <span class="comment">// 引入 react-native-splash-screen</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">ScreenHome</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="comment">// ...other code</span></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 隐藏启动页，如果不设置消失时间，在组件加载完启动页自动隐藏</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">SplashScreen</span>.<span class="title function_">hide</span>();</span><br><span class="line">    &#125;, <span class="number">5000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...other code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>iOS 设置</li>
</ul>
<p>1）更新 <code>AppDelegate.m</code>：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;React/RCTBundleURLProvider.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&lt;React/RCTRootView.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;SplashScreen.h&quot;</span>  <span class="comment">// 导入启动页插件</span></span></span><br><span class="line"></span><br><span class="line">@implementation AppDelegate</span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...其他代码</span></span><br><span class="line">    [self.window makeKeyAndVisible];</span><br><span class="line">    [SplashScreen show];  <span class="comment">// 显示启动页</span></span><br><span class="line">    <span class="keyword">return</span> YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>2）准备启动页图片</p>
<p><strong>文件必须是 png 格式的图片</strong>，命名需对应尺寸，可参考下面的命名：</p>
<blockquote>
<p>如需自动生成可使用这个网页：<a target="_blank" rel="noopener" href="https://www.appicon.build/">appicon</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>尺寸</th>
<th>名称</th>
<th>用途</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>640 x 960</td>
<td><a href="mailto:Default@2x.png">Default@2x.png</a></td>
<td>iPhone 4</td>
<td>非必须，推荐设置</td>
</tr>
<tr>
<td>640 x 1136</td>
<td><a href="mailto:Default-568h@2x.png">Default-568h@2x.png</a></td>
<td>iPhone 5</td>
<td>非必须，推荐设置</td>
</tr>
<tr>
<td>750 x 1334</td>
<td><a href="mailto:Default-667h@2x.png">Default-667h@2x.png</a></td>
<td>iPhone 6, 竖屏</td>
<td>必须（必须有至少一个启动页图片）</td>
</tr>
<tr>
<td>1242 x 2208</td>
<td><a href="mailto:Default-736h@3x.png">Default-736h@3x.png</a></td>
<td>iPhone 6 Plus, 竖屏</td>
<td>非必须，推荐设置</td>
</tr>
<tr>
<td>2208 x 1242</td>
<td><a href="mailto:Default-Landscape-736h@3x.png">Default-Landscape-736h@3x.png</a></td>
<td>iPhone 6 Plus, 横屏</td>
<td>非必须，推荐设置</td>
</tr>
<tr>
<td>1125 × 2436</td>
<td><a href="mailto:Default-812h@3x.png">Default-812h@3x.png</a></td>
<td>iPhone X, 竖屏</td>
<td>非必须，推荐设置</td>
</tr>
<tr>
<td>2436 x 1125</td>
<td><a href="mailto:Default-Landscape-812h@3x.png">Default-Landscape-812h@3x.png</a></td>
<td>iPhone X, 横屏</td>
<td>非必须，推荐设置</td>
</tr>
</tbody>
</table>
<p>NOTE:</p>
<ul>
<li>很多教程给出的启动页尺寸比上面的要多，有可能是 Xcode 版本不同导致，Xcode 9.2，iOS 7+ 只需要上面七个尺寸；</li>
<li>名称并非一定要按照上面的要求，直接使用 <code>Default尺寸x尺寸.png</code> 也可以；</li>
</ul>
<p>3）在 Xcode 中设置启动页</p>
<p>首先新建 <code>LaunchImage</code> 文件，操作步骤如下：</p>
<p><img src="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/launch_image1.png" alt="设置启动页"></p>
<p>然后在 <code>general</code> 设置中将启动页指向刚才新建的 <code>LaunchImage</code> 文件，<strong>注意 Launch Screen File 必须为空，不然就指向 LaunchScreen.xib 中默认的启动页了</strong>:</p>
<p><img src="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/launch_image2.png" alt="设置启动页"></p>
<ul>
<li>安卓配置</li>
</ul>
<p>1）更新 <code>MainActivity.java</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Bundle; <span class="comment">// here</span></span><br><span class="line"><span class="keyword">import</span> com.facebook.react.ReactActivity;</span><br><span class="line"><span class="comment">// react-native-splash-screen &gt;= 0.3.1</span></span><br><span class="line"><span class="keyword">import</span> org.devio.rn.splashscreen.SplashScreen; <span class="comment">// here</span></span><br><span class="line"><span class="comment">// react-native-splash-screen &lt; 0.3.1</span></span><br><span class="line"><span class="keyword">import</span> com.cboy.rn.splashscreen.SplashScreen; <span class="comment">// here</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">ReactActivity</span> &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        SplashScreen.show(<span class="built_in">this</span>);  <span class="comment">// here</span></span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...other code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2）新建 <code>launch_screen.xml</code></p>
<p>在 <code>app/src/main/res/layout</code> 中创建 <code>launch_screen.xml</code>（如果没有 <code>layout</code> 目录，新建），内容如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span> <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@drawable/launch_screen&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3）准备不同尺寸的启动页图片并放到项目中</p>
<p>安卓是通过文件夹路径寻找启动页面的，所以，多张尺寸的启动页名称相同，都为 <code>launch_screen.png</code>，但要放在不同文件夹中，文件夹放置目录为 <code>yourApp/android/app/src/main/res/</code>，名称及对应放置的图片尺寸如下：</p>
<table>
<thead>
<tr>
<th>文件夹名称</th>
<th>含义</th>
<th>文件夹内部图片尺寸</th>
<th>文件夹内部图片名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>drawable-ldpi</td>
<td>Low Density Screen</td>
<td>240x320</td>
<td>launch_screen.png</td>
</tr>
<tr>
<td>drawable-mdpi</td>
<td>Medium Density Screen</td>
<td>320x480</td>
<td>launch_screen.png</td>
</tr>
<tr>
<td>drawable-hdpi</td>
<td>High Density Screen</td>
<td>480x800</td>
<td>launch_screen.png</td>
</tr>
<tr>
<td>drawable-xhdpi</td>
<td>Extra-high density screen</td>
<td>720x1280</td>
<td>launch_screen.png</td>
</tr>
<tr>
<td>drawable-xxhdpi</td>
<td>xx-high density screen</td>
<td>960x1600</td>
<td>launch_screen.png</td>
</tr>
<tr>
<td>drawable-xxxhdpi</td>
<td>xxx-high density screen</td>
<td>1280x1920</td>
<td>launch_screen.png</td>
</tr>
</tbody>
</table>
<blockquote>
<p>建议直接从 <code>480x800</code> 起步放置 4 张图片就好。</p>
</blockquote>
<p>4）优化启动页出现前的短暂白屏</p>
<p>到这里，启动页功能已经 ok，但如果仔细看，可以看到启动页出现前会有短暂白屏，此时可通过更改<code>android/app/src/main/res/values/styles.xml</code> 解决：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;AppTheme&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;Theme.AppCompat.Light.NoActionBar&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--设置透明背景--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowIsTranslucent&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这种方案实际没有根本解决问题：会发现这样设置以后点击图片不能立即弹出应用，而有短暂的等待时间，待填坑。</p>
</blockquote>
<p>5）<strong>解决安卓 6.0，7.0 安装配置完成后出现闪退</strong>，参考下面设置：</p>
<p>在 <code>android/app/src/main/res/values</code> 下面新建 <code>colors.xml</code> 文件，内容如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- this is referenced by react-native-splash-screen and will throw an error if not defined.  its value does nothing, just here to avoid a runtime error. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">&quot;primary_dark&quot;</span>&gt;</span>#000000<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>因为 react-native-splash-screen 需要一个名为 <code>primary_dark</code> 的颜色值作为状态栏的颜色。</p>
<h2 id="3-4-最终效果图"><a href="#3-4-最终效果图" class="headerlink" title="3.4 最终效果图"></a>3.4 最终效果图</h2><p>设置完桌面图标、修改 APP 展示名称及设置启动页之后的效果图如下：</p>
<p><img src="https://raw.githubusercontent.com/xiaogliu/pic-lib/master/old/launch_image.gif" alt="图标及启动页"></p>
<h1 id="四-打包发布"><a href="#四-打包发布" class="headerlink" title="四 打包发布"></a>四 打包发布</h1><h2 id="4-1-安卓打包发布"><a href="#4-1-安卓打包发布" class="headerlink" title="4.1 安卓打包发布"></a>4.1 安卓打包发布</h2><ul>
<li>生成签名</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">keytool -genkey -v -keystore my-release-key.keystore -<span class="built_in">alias</span> my-key-alias -keyalg RSA -keysize 2048 -validity 10000</span><br></pre></td></tr></table></figure>
<p>如果使用 mac，执行该命令的目录随意。但一定要保管好自己的 <code>my-release-key.keystore</code> 文件，如果忘记签名，不能在原有 App 上面升级，只能重新打包发布。同时，不要将 <code>keystore</code> 文件放入版本控制中。</p>
<ul>
<li>设置 gradle 变量</li>
</ul>
<p>1）首先将签名文件 <code>my-release-key.keystore</code> 放在目录 <code>yourApp/android/app/</code> 下</p>
<p>2）修改文件 <code>yourApp/android/gradle.properties</code> 添加下面代码 (替换 <code>*****</code> 为正确的 keystore 密码、别名、和 key 密码)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MYAPP_RELEASE_STORE_FILE=my-release-key.keystore</span><br><span class="line">MYAPP_RELEASE_KEY_ALIAS=my-key-alias</span><br><span class="line">MYAPP_RELEASE_STORE_PASSWORD=*****</span><br><span class="line">MYAPP_RELEASE_KEY_PASSWORD=*****</span><br></pre></td></tr></table></figure>
<p>3）添加签名信息到 app 的 gradle 配置中</p>
<p>编辑文件 <code>yourApp/android/app/build.gradle</code> 加入签名信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    defaultConfig &#123; ... &#125;</span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="keyword">if</span> (project.hasProperty(<span class="string">&#x27;MYAPP_RELEASE_STORE_FILE&#x27;</span>)) &#123;</span><br><span class="line">                storeFile <span class="title function_">file</span><span class="params">(MYAPP_RELEASE_STORE_FILE)</span></span><br><span class="line">                storePassword MYAPP_RELEASE_STORE_PASSWORD</span><br><span class="line">                keyAlias MYAPP_RELEASE_KEY_ALIAS</span><br><span class="line">                keyPassword MYAPP_RELEASE_KEY_PASSWORD</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            ...</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>打包</li>
</ul>
<p>在终端输入下面命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> android &amp;&amp; ./gradlew assembleRelease</span><br></pre></td></tr></table></figure>
<p>等待构建完成，便可以在 <code>yourApp/android/app/build/outputs/apk/release/app-release.apk</code> 中找到编译后的发布版本。</p>
<p>NOTE：如果遇到这个错误：<code>Execution failed for task &#39;:app:processReleaseResources&#39;</code>，做下述修改：</p>
<p>在 <code>yourApp/android/gradle.properties</code> 文件最后添加下面代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">classpath <span class="string">&#x27;com.android.tools.build:gradle:3.0.0&#x27;</span></span><br><span class="line">distributionUrl=<span class="attr">https</span>:<span class="comment">//services.gradle.org/distributions/gradle-4.1-all.zip</span></span><br><span class="line">android.<span class="property">enableAapt2</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>如果还有其他问题，可参考下这篇文章：<a target="_blank" rel="noopener" href="https://github.com/xiaogliu/step_by_step/blob/master/other/react/react_native/36.%E5%AE%89%E5%8D%93%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83%E9%82%A3%E4%BA%9B%E5%9D%91.md">安卓打包发布那些坑</a></p>
<h2 id="4-2-iOS-打包发布"><a href="#4-2-iOS-打包发布" class="headerlink" title="4.2 iOS 打包发布"></a>4.2 iOS 打包发布</h2><p>iOS 打包发布有些麻烦，对于大多数非 iOS 开发者的限制不是 React Native 本身，而是苹果本身的机制，比如，必须要有苹果开发者账号。iOS 打包发布打算另写文章。如果要了解发布流程，可以参考这两篇文章：<a target="_blank" rel="noopener" href="http://www.cocoachina.com/appstore/20170627/19622.html">iOS 发布 App Store 详细图文教程</a>，<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6d1ee919ded3">React Native iOS 详细打包步骤</a></p>
<blockquote>
<p>注意一点：打包时 <code>--entry-file</code> 安卓、iOS 是同一个入口文件 <code>index.js</code>，不在区分安卓/iOS</p>
</blockquote>
<h1 id="五-小结"><a href="#五-小结" class="headerlink" title="五 小结"></a>五 小结</h1><p>到目前位置，从改造官方 demo 开始，一个比较完整的 React Native App 完成了，在此基础上可以不断扩展完善。</p>
<p>当然，从生产角度来说，这个 demo 的完成度不高，比如，很多样式还是最原始的状态、比如 WebView（App 中嵌入 H5）、下拉刷新等也没有涉及。其中 WebView、下拉刷新等常用功能会逐步集成到这个 demo 中，但样式并不打算做过多优化，因为从使用角度来讲，样式的完成度越高意味着可定制性越差，并且，那样也会导致代码的可读性变差。希望这个 demo 可以成为完整、普适但不臃肿的脚手架。</p>
<p>不过，同一套代码，安卓和 iOS 上展示的样式会有不同，针对这个，会写文章单独说明。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://github.com/react-navigation/react-navigation/issues/707#issuecomment-299859578">Choose transition mode for each screen in StackNavigator</a><br><a target="_blank" rel="noopener" href="http://www.devio.org/2017/10/06/How-to-develop-a-React-Native-application-for-Android-and-iOS-dual-platforms/">React Native 开发适配心得</a><br><a target="_blank" rel="noopener" href="https://developer.apple.com/ios/human-interface-guidelines/icons-and-images/app-icon/">Apple Developer - App Icon</a><br><a target="_blank" rel="noopener" href="https://github.com/crazycodeboy/react-native-splash-screen/issues/149">在模拟器安卓 4.0 上运行正常，在手机上安卓 6.0 7.0 都闪退 不知道什么情况求解</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45954209/issues-with-resources-generated-by-react-in-android-studio-3">Issues with resources generated by react in Android Studio 3</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000004878644">React Native 的默认单位和自适应布局方案</a></p>

    
  </div>

</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2018/02/27/develop-react-native-app-1/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2018/04/28/develop-full-page-scroll-by-es6/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              目录
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'xiaogliu';
    
    var disqus_url = 'https://xiaogliu.github.io/2018/02/27/develop-react-native-app-2/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//xiaogliu.disqus.com/count.js" async></script>



    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
